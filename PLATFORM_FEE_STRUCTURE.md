# Platform Fee Structure: Detailed Guide

This document outlines the new fee structure implemented in the backend. These fees are designed to ensure platform sustainability and fair creator compensation.

---

## 1. Core Principles

1.  **Platform Performance Fee:** A fixed percentage of *all net profits* generated by bots and vaults goes to the platform.
2.  **Premium Strategy Surcharge:** An additional percentage is added to the Platform Fee if a Premium Strategy is used.
3.  **Creator Profit Share:** The bot creator defines their own percentage, which is taken from the profits *after* the Platform Fee.
4.  **Self-Use Exemption:** When a creator uses their *own* bot for their *personal trades*, the Creator Profit Share (their own fee) is waived. The Platform Fee still applies.

---

## 2. Fee Breakdown

### A. Platform Fees

These fees are deducted from **Net Profits** and go to the platform.

*   **Base Platform Fee:** `5%` of Net Profit.
*   **Premium Strategy Surcharge:** `+20%` of Net Profit.

    *   **Total Platform Fee:**
        *   **Free Strategy (RSI, RANDOM):** `5%` (Base Only)
        *   **Premium Strategy (MACD, SMA):** `25%` (5% Base + 20% Surcharge)

### B. Creator Profit Share

*   The creator defines this percentage when creating or making a bot public.
*   This fee is deducted from the **remaining profit** after the Platform Fee has been taken.
*   **Example:** If Platform takes 25% and Creator sets 50%, then 75% of the gross profit is deducted before the user gets their payout.

---

## 3. Fee Application Scenarios

### Scenario 1: Copy Trading (Cloned Bots)

*   **Trigger:** Applies to every **winning trade** executed by a cloned bot.
*   **Calculation:**
    1.  Calculate `Gross Profit` (Payout - Stake).
    2.  Calculate `Platform Cut` based on the bot's strategy (5% for Free, 25% for Premium).
    3.  Calculate `Creator Cut` based on the bot's `profitSharePercent` (e.g., 50%).
    4.  `Net Payout to User` = `Gross Payout` - `Platform Cut` - `Creator Cut`.
*   **Funds Flow:**
    *   `Platform Cut` is a deduction from the user's potential profit.
    *   `Creator Cut` is directly transferred from the user's winning trade profit to the **Creator's wallet**.

### Scenario 2: Investment Vaults

*   **Trigger:** Applies only at the **end of the vault's lock-up period**, and only if the vault generated an **overall net profit**.
*   **Calculation:**
    1.  Calculate `Total Net Profit` for the entire vault pool (`Final Pool Amount - Initial User Capital`).
    2.  Calculate `Platform Cut` from this `Total Net Profit` (5% for Free Strategy, 25% for Premium Strategy).
    3.  Calculate `Creator Cut` from the `Total Net Profit` (based on vault's `profitSharePercent`).
    4.  `Net Profit for Users` = `Total Net Profit` - `Platform Cut` - `Creator Cut`.
    5.  `User Payout` = `User's Principal` + (`User's Share of Net Profit for Users`).
*   **Funds Flow:**
    *   `Platform Cut` is a deduction from the vault's overall profit.
    *   `Creator Cut` is directly transferred from the vault's overall profit to the **Creator's wallet**.

---

## 4. Examples (Assuming $100 Gross Profit)

### Example A: Free Strategy (RSI/RANDOM)
*   **Platform Fee:** 5%
*   **Creator Fee:** User sets to 50%

| Item | Amount |
| :--- | :--- |
| Gross Profit | $100.00 |
| - Platform Fee (5%) | $5.00 |
| - Creator Fee (50%) | $50.00 |
| **Net to User** | **$45.00** |

### Example B: Premium Strategy (MACD/SMA)
*   **Platform Fee:** 25% (5% Base + 20% Surcharge)
*   **Creator Fee:** User sets to 50%

| Item | Amount |
| :--- | :--- |
| Gross Profit | $100.00 |
| - Platform Fee (25%) | $25.00 |
| - Creator Fee (50%) | $50.00 |
| **Net to User** | **$25.00** |

### Example C: Creator Using Own Bot (Free Strategy)
*   **Platform Fee:** 5%
*   **Creator Fee:** 0% (Self-use exemption)

| Item | Amount |
| :--- | :--- |
| Gross Profit | $100.00 |
| - Platform Fee (5%) | $5.00 |
| - Creator Fee (0%) | $0.00 |
| **Net to Creator** | **$95.00** |

---

## 5. Ledger Entries

To ensure transparency and auditability, specific ledger entries are created:

*   **`PLATFORM_FEE`:** Recorded as a deduction from the user's (or vault's) profit.
*   **`PLATFORM_FEE` (for Creator credit):** Recorded as a credit to the Creator's wallet when they receive their share.
    *   *Note:* The ledger entry `PLATFORM_FEE` is reused. Frontend should interpret contextually. You might want to suggest a new enum like `CREATOR_PROFIT_SHARE_RECEIVED` for clearer distinction.

---
